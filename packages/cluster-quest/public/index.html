<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grist Cluster Quest - Formation RAG</title>

    <!-- Grist Plugin API -->
    <script src="https://docs.getgrist.com/grist-plugin-api.js"></script>

    <!-- Reveal.js -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js@4.5.0/dist/reveal.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js@4.5.0/dist/theme/black.css">

    <link rel="stylesheet" href="./styles.css">
</head>
<body>
    <!-- Status Bar -->
    <div id="status-bar">
        <div class="status-item">
            <div id="connection-status"></div>
            <span id="connection-text">Connexion...</span>
        </div>
        <div class="status-item">
            <span>ğŸ‘¤ <span id="user-name">-</span></span>
        </div>
        <div class="status-item">
            <span>ğŸ¯ <span id="user-score">0</span> pts</span>
        </div>
        <div class="status-item">
            <span>ğŸ“Š Chapitre <span id="current-chapter">1</span>/10</span>
        </div>
    </div>

    <!-- User Login Modal -->
    <div id="user-login">
        <div class="login-card">
            <h2 style="text-align: center; margin-top: 0;">ğŸ® Bienvenue !</h2>
            <p style="font-size: 0.9em; text-align: center; opacity: 0.8;">
                ConnectÃ© en tant que: <strong id="grist-user-display">Chargement...</strong>
            </p>
            <button id="start-button" onclick="startSession()">ğŸš€ DÃ©marrer la Formation</button>
            <p style="font-size: 0.75em; margin-top: 1em; opacity: 0.6; text-align: center;">
                Votre progression sera enregistrÃ©e automatiquement
            </p>
            <div id="login-error" class="message-box error" style="display: none; margin-top: 1em;"></div>
        </div>
    </div>

    <div class="reveal">
        <div class="slides">
            <!-- SLIDE 0: ACCUEIL -->
            <section data-chapter="0">
                <h1>ğŸ® Grist Cluster Quest</h1>
                <h3>Formation RAG & Recherche Vectorielle</h3>

                <div class="card">
                    <p><span class="emoji-large">ğŸ¯</span></p>
                    <p>MaÃ®trisez les stratÃ©gies RAG avec Grist<br>Exercices pratiques et interactifs</p>
                </div>

                <div class="card-grid">
                    <div class="card card-small">
                        <strong>10 Chapitres</strong><br>
                        <span style="font-size: 0.8em;">RAG progressif</span>
                    </div>
                    <div class="card card-small">
                        <strong>Formules RÃ©elles</strong><br>
                        <span style="font-size: 0.8em;">CREATE_VECTOR</span>
                    </div>
                    <div class="card card-small">
                        <strong>Conditions</strong><br>
                        <span style="font-size: 0.8em;">Filtrage intelligent</span>
                    </div>
                    <div class="card card-small">
                        <strong>Multi-Vecteurs</strong><br>
                        <span style="font-size: 0.8em;">Hierarchical RAG</span>
                    </div>
                </div>
            </section>

            <!-- CHAPITRE 1: QUIZ BASES -->
            <section data-chapter="1">
                <h2>ğŸ“š Chapitre 1: Les Bases</h2>
                <span class="level-indicator level-1">DÃ©butant</span>

                <div class="card">
                    <h3>ğŸ¤” Qu'est-ce qu'un Vecteur ?</h3>
                    <p style="font-size: 0.9em;">Un vecteur capture le <strong>sens sÃ©mantique</strong> d'un texte</p>
                </div>

                <div class="exercise">
                    <h3>ğŸ¯ Question</h3>
                    <p>Un vecteur dans Grist capture...</p>

                    <select id="ch1-quiz">
                        <option value="">-- Choisissez --</option>
                        <option value="mots">Les mots exacts du texte</option>
                        <option value="sens">Le sens du texte</option>
                        <option value="longueur">La longueur du texte</option>
                    </select>

                    <button onclick="submitChapter1()">âœ“ Valider</button>
                    <div id="ch1-feedback" class="feedback"></div>
                </div>
            </section>

            <!-- CHAPITRE 2: CREATE_VECTOR THÃ‰ORIE -->
            <section data-chapter="2">
                <h2>ğŸ§  Chapitre 2: CREATE_VECTOR</h2>
                <span class="level-indicator level-1">DÃ©butant</span>

                <div class="card">
                    <h3>ğŸ”¢ Chunking Strategy</h3>
                    <p style="font-size: 0.9em;">
                        <strong>Context-Aware Chunking</strong><br>
                        Choisir quels champs vectoriser = meilleure prÃ©cision
                    </p>
                </div>

                <div class="card">
                    <p style="font-size: 0.85em; text-align: left;">
                        <strong>Deux approches :</strong><br>
                        â€¢ <code>grist_record_embedding</code> : Tous les champs (automatique)<br>
                        â€¢ <code>grist.CREATE_VECTOR($nom, $desc)</code> : Champs ciblÃ©s<br>
                        <br>
                        ğŸ’¡ Chunking ciblÃ© = prÃ©cision sÃ©mantique
                    </p>
                </div>
            </section>

            <!-- CHAPITRE 2.5: EXERCICE CREATE_VECTOR SIMPLE -->
            <section data-chapter="2">
                <h2>âš¡ Exercice: CREATE_VECTOR Simple</h2>
                <span class="level-indicator level-2">IntermÃ©diaire</span>

                <div class="exercise">
                    <h3>ğŸ§ª Testez votre premier vecteur</h3>
                    <p style="font-size: 0.85em;">CrÃ©ez un produit et observez le vecteur calculÃ©</p>

                    <div class="card" style="background: rgba(255, 193, 7, 0.1); margin-bottom: 1em;">
                        <p style="font-size: 0.8em; margin: 0;">
                            ğŸ’¡ Le vecteur sera calculÃ© par Grist avec :<br>
                            <code>grist.CREATE_VECTOR($nom, $description)</code>
                        </p>
                    </div>

                    <input type="text" id="simple-nom" placeholder="Nom du produit (ex: Pull laine mÃ©rinos)">
                    <textarea id="simple-description" rows="2" placeholder="Description (ex: Doux et chaud, parfait pour l'hiver)"></textarea>

                    <button onclick="testCreateVectorSimple()">â–¶ï¸ CrÃ©er et Analyser</button>
                    <div id="ch2-5-feedback" class="feedback"></div>

                    <div id="vector-comparison" class="data-preview" style="display: none; margin-top: 1em;">
                        <h4 style="margin-top: 0;">ğŸ“Š Analyse du Vecteur</h4>
                        <div id="vector-details"></div>
                    </div>
                </div>
            </section>

            <!-- CHAPITRE 3: CONDITIONS - EXISTENCE -->
            <section data-chapter="3">
                <h2>ğŸšï¸ Chapitre 3: Filtrage Conditionnel</h2>
                <span class="level-indicator level-2">IntermÃ©diaire</span>

                <div class="card">
                    <h3>ğŸ” Existence Conditionnelle</h3>
                    <p style="font-size: 0.9em;">
                        ContrÃ´ler <strong>qui peut Ãªtre trouvÃ©</strong> dans les recherches
                    </p>
                </div>

                <div class="card">
                    <p style="font-size: 0.85em; text-align: left;">
                        <strong>Exemple :</strong><br>
                        <code>grist.CREATE_VECTOR($nom, $desc)<br>
                        &nbsp;&nbsp;if $statut == "publiÃ©"<br>
                        &nbsp;&nbsp;else None</code><br>
                        <br>
                        âœ… PubliÃ©s : cherchables<br>
                        âŒ Brouillons : invisibles
                    </p>
                </div>
            </section>

            <!-- CHAPITRE 3.5: EXERCICE FILTRAGE -->
            <section data-chapter="3">
                <h2>âš¡ Exercice: Filtrage Automatique</h2>
                <span class="level-indicator level-2">IntermÃ©diaire</span>

                <div class="exercise">
                    <h3>ğŸ§ª CrÃ©ez 3 produits avec statuts diffÃ©rents</h3>

                    <div style="border: 2px solid rgba(255, 255, 255, 0.2); padding: 1em; margin: 1em 0; border-radius: 6px;">
                        <h4 style="margin-top: 0;">Produit 1</h4>
                        <input type="text" id="prod1-nom" placeholder="Nom" value="T-shirt bio">
                        <input type="text" id="prod1-desc" placeholder="Description" value="Coton biologique doux">
                        <select id="prod1-statut">
                            <option value="publiÃ©" selected>âœ… PubliÃ©</option>
                            <option value="brouillon">ğŸ“ Brouillon</option>
                        </select>
                    </div>

                    <div style="border: 2px solid rgba(255, 255, 255, 0.2); padding: 1em; margin: 1em 0; border-radius: 6px;">
                        <h4 style="margin-top: 0;">Produit 2</h4>
                        <input type="text" id="prod2-nom" placeholder="Nom" value="Jean recyclÃ©">
                        <input type="text" id="prod2-desc" placeholder="Description" value="Denim Ã©co-responsable">
                        <select id="prod2-statut">
                            <option value="publiÃ©">âœ… PubliÃ©</option>
                            <option value="brouillon" selected>ğŸ“ Brouillon</option>
                        </select>
                    </div>

                    <div style="border: 2px solid rgba(255, 255, 255, 0.2); padding: 1em; margin: 1em 0; border-radius: 6px;">
                        <h4 style="margin-top: 0;">Produit 3</h4>
                        <input type="text" id="prod3-nom" placeholder="Nom" value="Pull laine">
                        <input type="text" id="prod3-desc" placeholder="Description" value="Laine mÃ©rinos chaude">
                        <select id="prod3-statut">
                            <option value="publiÃ©" selected>âœ… PubliÃ©</option>
                            <option value="brouillon">ğŸ“ Brouillon</option>
                        </select>
                    </div>

                    <button onclick="testConditionalFiltering()">â–¶ï¸ CrÃ©er et Tester le Filtrage</button>
                    <div id="ch3-5-feedback" class="feedback"></div>

                    <div id="filtering-results" class="data-preview" style="display: none; margin-top: 1em;">
                        <h4 style="margin-top: 0;">ğŸ“Š RÃ©sultats du Filtrage</h4>
                        <div id="filtering-details"></div>
                    </div>
                </div>
            </section>

            <!-- CHAPITRE 4: CONDITIONS - ENRICHISSEMENT -->
            <section data-chapter="4">
                <h2>ğŸ·ï¸ Chapitre 4: Enrichissement Contextuel</h2>
                <span class="level-indicator level-2">IntermÃ©diaire</span>

                <div class="card">
                    <h3>ğŸ¨ Labels et Badges</h3>
                    <p style="font-size: 0.9em;">
                        Ajouter du <strong>contexte business</strong> dans l'embedding
                    </p>
                </div>

                <div class="card">
                    <p style="font-size: 0.85em; text-align: left;">
                        <strong>Exemple :</strong><br>
                        <code>grist.CREATE_VECTOR(<br>
                        &nbsp;&nbsp;("ğŸ”¥ PROMO " if $remise > 20 else "") +<br>
                        &nbsp;&nbsp;("ğŸ†• " if $age_jours < 7 else "") +<br>
                        &nbsp;&nbsp;$nom + " " + $desc<br>
                        )</code><br>
                        <br>
                        ğŸ’¡ Recherche "promo" â†’ items ğŸ”¥ ressortent mieux !
                    </p>
                </div>
            </section>

            <!-- CHAPITRE 4.5: EXERCICE ENRICHISSEMENT -->
            <section data-chapter="4">
                <h2>âš¡ Exercice: Badges Contextuels</h2>
                <span class="level-indicator level-2">IntermÃ©diaire</span>

                <div class="exercise">
                    <h3>ğŸ§ª CrÃ©ez un produit promotionnel</h3>

                    <input type="text" id="promo-nom" placeholder="Nom" value="Chaussures sport">
                    <textarea id="promo-desc" rows="2" placeholder="Description" value="LÃ©gÃ¨res et confortables pour le running"></textarea>
                    <input type="number" id="promo-prix" placeholder="Prix (â‚¬)" value="50">
                    <input type="number" id="promo-remise" placeholder="Remise (%)" value="30">

                    <button onclick="testEnrichissement()">â–¶ï¸ CrÃ©er et Comparer</button>
                    <div id="ch4-5-feedback" class="feedback"></div>

                    <div id="enrichissement-results" class="data-preview" style="display: none; margin-top: 1em;">
                        <h4 style="margin-top: 0;">ğŸ“Š Impact de l'Enrichissement</h4>
                        <div id="enrichissement-details"></div>
                    </div>
                </div>
            </section>

            <!-- CHAPITRE 5: VECTOR_SEARCH BASES -->
            <section data-chapter="5">
                <h2>ğŸ” Chapitre 5: VECTOR_SEARCH</h2>
                <span class="level-indicator level-2">IntermÃ©diaire</span>

                <div class="card">
                    <h3>ğŸ¯ Recherche SÃ©mantique</h3>
                    <p style="font-size: 0.9em;">
                        <code>grist.VECTOR_SEARCH()</code> trouve les rÃ©sultats similaires
                    </p>
                </div>

                <div class="card">
                    <p style="font-size: 0.85em; text-align: left;">
                        <strong>ParamÃ¨tres clÃ©s :</strong><br>
                        â€¢ <code>threshold</code> : Seuil de similaritÃ© (0-1)<br>
                        â€¢ <code>limit</code> : Nombre de rÃ©sultats (top-K)<br>
                        <br>
                        ğŸ’¡ Threshold = curseur Recall â‡„ Precision
                    </p>
                </div>
            </section>

            <!-- CHAPITRE 5.5: EXERCICE VECTOR_SEARCH -->
            <section data-chapter="5">
                <h2>âš¡ Exercice: Testez VECTOR_SEARCH</h2>
                <span class="level-indicator level-2">IntermÃ©diaire</span>

                <div class="exercise">
                    <h3>ğŸ§ª Recherche interactive</h3>

                    <label style="font-size: 0.9em; margin-bottom: 0.3em; display: block;">RequÃªte :</label>
                    <input type="text" id="search-query" placeholder="Ex: vÃªtements d'Ã©tÃ© confortables" style="margin-bottom: 0.5em;">

                    <label style="font-size: 0.9em; margin-bottom: 0.3em; display: block;">
                        Threshold : <span id="threshold-value">0.7</span>
                    </label>
                    <input type="range" id="search-threshold" min="0.5" max="0.9" step="0.05" value="0.7" style="width: 100%; margin-bottom: 0.5em;" oninput="document.getElementById('threshold-value').textContent = this.value">
                    <p style="font-size: 0.75em; opacity: 0.7; margin-top: 0;">
                        â† Bas (+ rÃ©sultats, - prÃ©cis) | Haut (- rÃ©sultats, + prÃ©cis) â†’
                    </p>

                    <label style="font-size: 0.9em; margin-bottom: 0.3em; display: block;">Limite :</label>
                    <input type="number" id="search-limit" value="5" min="1" max="20" style="margin-bottom: 1em;">

                    <button onclick="testVectorSearch()">ğŸ” Rechercher</button>
                    <div id="ch5-5-feedback" class="feedback"></div>

                    <div id="search-results" class="data-preview" style="display: none; margin-top: 1em;">
                        <h4 style="margin-top: 0;">ğŸ“Š RÃ©sultats de Recherche</h4>
                        <div id="search-details"></div>
                    </div>
                </div>
            </section>

            <!-- CHAPITRE 6: HIERARCHICAL RAG -->
            <section data-chapter="6">
                <h2>ğŸŒˆ Chapitre 6: Multi-Vecteurs</h2>
                <span class="level-indicator level-3">AvancÃ©</span>

                <div class="card">
                    <h3>ğŸ¯ Hierarchical RAG</h3>
                    <p style="font-size: 0.9em;">
                        Plusieurs vecteurs = plusieurs <strong>couches sÃ©mantiques</strong>
                    </p>
                </div>

                <div class="card">
                    <p style="font-size: 0.85em; text-align: left;">
                        <strong>StratÃ©gie :</strong><br>
                        â€¢ <code>vecteur_marketing</code> : Pour clients<br>
                        â€¢ <code>vecteur_technique</code> : Pour pros<br>
                        <br>
                        ğŸ’¡ Bon embedding = bonne audience
                    </p>
                </div>
            </section>

            <!-- CHAPITRE 6.5: EXERCICE MULTI-VECTEURS -->
            <section data-chapter="6">
                <h2>âš¡ Exercice: Produit Multi-Profils</h2>
                <span class="level-indicator level-3">AvancÃ©</span>

                <div class="exercise">
                    <h3>ğŸ§ª CrÃ©ez un produit avec 2 vecteurs</h3>

                    <input type="text" id="multi-nom" placeholder="Nom" value="Ordinateur portable ProX">
                    <textarea id="multi-marketing" rows="2" placeholder="Description marketing (pour clients)" value="Ultra lÃ©ger et rapide, parfait pour le travail nomade et crÃ©atif"></textarea>
                    <textarea id="multi-technique" rows="2" placeholder="CaractÃ©ristiques techniques (pour pros)" value="Intel i7-12700H, 32GB DDR5, RTX 3070, NVMe 1TB, Ã©cran 4K 120Hz"></textarea>

                    <button onclick="testMultiVecteurs()">â–¶ï¸ CrÃ©er et Comparer</button>
                    <div id="ch6-5-feedback" class="feedback"></div>

                    <div id="multi-results" class="data-preview" style="display: none; margin-top: 1em;">
                        <h4 style="margin-top: 0;">ğŸ“Š Comparaison Multi-Vecteurs</h4>
                        <div id="multi-details"></div>
                    </div>
                </div>
            </section>

            <!-- CHAPITRE 7: QUERY EXPANSION -->
            <section data-chapter="7">
                <h2>ğŸ“ Chapitre 7: Query Expansion</h2>
                <span class="level-indicator level-2">IntermÃ©diaire</span>

                <div class="card">
                    <h3>ğŸ¯ Enrichir les RequÃªtes</h3>
                    <p style="font-size: 0.9em;">
                        RequÃªtes plus spÃ©cifiques = rÃ©sultats plus prÃ©cis
                    </p>
                </div>

                <div class="exercise">
                    <h3>ğŸ§ª Test Comparatif</h3>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1em;">
                        <div style="border: 2px solid rgba(255, 100, 100, 0.3); padding: 1em; border-radius: 6px;">
                            <h4 style="margin-top: 0;">âŒ RequÃªte Simple</h4>
                            <input type="text" id="query-simple" value="pull" readonly style="background: rgba(0,0,0,0.5);">
                            <p style="font-size: 0.8em; margin-top: 0.5em;">Trop vague, beaucoup de rÃ©sultats peu prÃ©cis</p>
                        </div>
                        <div style="border: 2px solid rgba(100, 255, 100, 0.3); padding: 1em; border-radius: 6px;">
                            <h4 style="margin-top: 0;">âœ… RequÃªte ExpansÃ©e</h4>
                            <input type="text" id="query-expanded" value="pull laine hiver chaud confortable tricot doux" readonly style="background: rgba(0,0,0,0.5);">
                            <p style="font-size: 0.8em; margin-top: 0.5em;">PrÃ©cise, moins de rÃ©sultats mais trÃ¨s pertinents</p>
                        </div>
                    </div>

                    <button onclick="testQueryExpansion()">â–¶ï¸ Comparer les deux requÃªtes</button>
                    <div id="ch7-feedback" class="feedback"></div>

                    <div id="expansion-results" class="data-preview" style="display: none; margin-top: 1em;">
                        <h4 style="margin-top: 0;">ğŸ“Š Comparaison</h4>
                        <div id="expansion-details"></div>
                    </div>
                </div>
            </section>

            <!-- CHAPITRE 8: RE-RANKING -->
            <section data-chapter="8">
                <h2>ğŸšï¸ Chapitre 8: Re-ranking Strategy</h2>
                <span class="level-indicator level-3">AvancÃ©</span>

                <div class="card">
                    <h3>ğŸ¯ RÃ©cupÃ©ration en 2 Ã‰tapes</h3>
                    <p style="font-size: 0.9em;">
                        StratÃ©gie recommandÃ©e pour presque tous les cas RAG
                    </p>
                </div>

                <div class="card">
                    <p style="font-size: 0.85em; text-align: left;">
                        <strong>Processus :</strong><br>
                        1ï¸âƒ£ RÃ©cupÃ©ration large (threshold=0.5, limit=20)<br>
                        2ï¸âƒ£ Filtrage prÃ©cis (garder top 5 avec score > 0.8)<br>
                        <br>
                        âœ… Meilleure couverture + prÃ©cision
                    </p>
                </div>

                <div class="exercise">
                    <h3>ğŸ§ª Comparez les stratÃ©gies</h3>

                    <button onclick="testReranking()">â–¶ï¸ Tester Re-ranking vs Direct</button>
                    <div id="ch8-feedback" class="feedback"></div>

                    <div id="reranking-results" class="data-preview" style="display: none; margin-top: 1em;">
                        <h4 style="margin-top: 0;">ğŸ“Š Comparaison</h4>
                        <div id="reranking-details"></div>
                    </div>
                </div>
            </section>

            <!-- CHAPITRE 9: CAS D'USAGE COMPLET -->
            <section data-chapter="9">
                <h2>ğŸš€ Chapitre 9: SystÃ¨me Complet</h2>
                <span class="level-indicator level-3">AvancÃ©</span>

                <div class="card">
                    <h3>ğŸ¯ E-commerce Saisonnier</h3>
                    <p style="font-size: 0.9em;">
                        SynthÃ¨se : toutes les stratÃ©gies RAG combinÃ©es
                    </p>
                </div>

                <div class="card">
                    <p style="font-size: 0.85em; text-align: left;">
                        <strong>StratÃ©gies appliquÃ©es :</strong><br>
                        âœ… Context-Aware Chunking<br>
                        âœ… Conditional Embeddings (filtrage)<br>
                        âœ… Contextual Retrieval (badges)<br>
                        âœ… Hierarchical RAG (multi-vecteurs)<br>
                        âœ… Re-ranking (threshold optimisÃ©)
                    </p>
                </div>

                <div class="exercise">
                    <h3>ğŸ§ª Testez des scÃ©narios</h3>

                    <select id="scenario-mois">
                        <option value="6">Juin (â˜€ï¸ Ã‰tÃ©)</option>
                        <option value="12">DÃ©cembre (â„ï¸ Hiver)</option>
                    </select>

                    <input type="text" id="scenario-query" placeholder="RequÃªte (ex: vÃªtements)">

                    <button onclick="testScenarioComplet()">â–¶ï¸ Tester le SystÃ¨me Complet</button>
                    <div id="ch9-feedback" class="feedback"></div>

                    <div id="scenario-results" class="data-preview" style="display: none; margin-top: 1em;">
                        <h4 style="margin-top: 0;">ğŸ“Š RÃ©sultats Contextuels</h4>
                        <div id="scenario-details"></div>
                    </div>
                </div>
            </section>

            <!-- CHAPITRE 10: LEADERBOARD -->
            <section data-chapter="10">
                <h2>ğŸ† Classement des Participants</h2>

                <div id="leaderboard" class="data-preview">
                    <div class="spinner"></div>
                    <p style="text-align: center; opacity: 0.7;">Chargement du classement...</p>
                </div>

                <div class="card" style="margin-top: 1em;">
                    <h3>ğŸ‰ FÃ©licitations !</h3>
                    <p>Votre score: <strong><span id="final-score">0</span> points</strong></p>
                    <p style="font-size: 0.85em; opacity: 0.8;">
                        Temps total: <span id="final-time">-</span> minutes
                    </p>
                </div>

                <div class="card" style="margin-top: 1em; background: rgba(33, 150, 243, 0.1);">
                    <h3>ğŸ“ Vous maÃ®trisez maintenant :</h3>
                    <p style="font-size: 0.85em; text-align: left;">
                        âœ… CREATE_VECTOR et chunking conscient<br>
                        âœ… Conditions et filtrage automatique<br>
                        âœ… Enrichissement contextuel<br>
                        âœ… VECTOR_SEARCH et paramÃ¨tres<br>
                        âœ… Hierarchical RAG (multi-vecteurs)<br>
                        âœ… Query Expansion<br>
                        âœ… Re-ranking Strategy<br>
                        âœ… SystÃ¨me RAG complet
                    </p>
                </div>
            </section>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/reveal.js@4.5.0/dist/reveal.js"></script>
    <script src="./app.js"></script>
</body>
</html>
